version: '3.8'

services:
  # Master server - gestiona los volumenes y metadata
  seaweedfs-master:
    image: chrislusf/seaweedfs:latest
    container_name: seaweedfs-master
    restart: unless-stopped
    command: master -ip=seaweedfs-master
    volumes:
      - seaweedfs_data:/data
    ports:
      - "9333:9333"   # Master server gRPC port
      - "19333:19333" # Master server HTTP port
    networks:
      - seaweedfs-network

  # Volume server - almacena los archivos
  seaweedfs-volume:
    image: chrislusf/seaweedfs:latest
    container_name: seaweedfs-volume
    restart: unless-stopped
    command: volume -mserver=seaweedfs-master:9333 -port=8080 -dir=/data
    volumes:
      - seaweedfs_data:/data
    ports:
      - "8080:8080"   # Volume server port
      - "18080:18080" # Volume server HTTP port
    depends_on:
      - seaweedfs-master
    networks:
      - seaweedfs-network

  # Filer server - API REST para subir/ver archivos
  seaweedfs-filer:
    image: chrislusf/seaweedfs:latest
    container_name: seaweedfs-filer
    restart: unless-stopped
    command: filer -master=seaweedfs-master:9333 -ip=seaweedfs-filer
    volumes:
      - seaweedfs_data:/data
    ports:
      - "8888:8888"   # Filer server port (para nuestra app)
      - "18888:18888" # Filer server gRPC port
    depends_on:
      - seaweedfs-master
      - seaweedfs-volume
    networks:
      - seaweedfs-network

volumes:
  seaweedfs_data:
    driver: local

networks:
  seaweedfs-network:
    driver: bridge